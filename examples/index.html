<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Positional Audio Example — Networked-Aframe</title>
    <meta name="description" content="Positional Audio Example — Networked-Aframe" />

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/akbartus/A-Frame-Component-Postprocessing/dist/post-processing.min.js"></script>
    <script src="./components/hdr-light.js"></script>
   <script src="./components/combo-ocean.js"></script>
   <script src="https://supereggbert.github.io/aframe-htmlembed-component/dist/build.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.5.0/socket.io.slim.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="/dist/networked-aframe.js"></script>
 
    <script>



      // see issue https://github.com/networked-aframe/networked-aframe/issues/267
      NAF.schemas.getComponentsOriginal = NAF.schemas.getComponents;
      NAF.schemas.getComponents = (template) => {
        if (!NAF.schemas.hasTemplate('#avatar-template')) {
          NAF.schemas.add({
            template: '#avatar-template',
            components: [
              'position',
              'rotation',
              {
                selector: '.head',
                component: 'material',
                property: 'color'
              }
            ]
          });
        }
        const components = NAF.schemas.getComponentsOriginal(template);
        return components;
      };
      
      

    </script>
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
  </head>
  <body>
    <a-scene
    hdri
    renderer="
    colorManagement: true; physicallyCorrectLights: true;"
      networked-scene="
      room: basic-audio;
      debug: true;
      adapter: easyrtc;
      audio: true;
    "
    >
      <a-assets>
        <!-- Templates -->

       <!-- Camera Rig / Player -->
       <template id="rig-template">
        <a-entity></a-entity>
      </template>

      <template id="avatar-template">
        <a-entity
          scale="3 3 3"
          class="avatar"
          networked-audio-source="positional:false"
          player-info
        >
          <a-gltf-model
            src="#avatarmodel"
            rotation="0 -180 0"
            position="0 -0.7 0"
            scale="2 2 2"
          ></a-gltf-model>
          <!-- <a-text
            class="nametag"
            value="?"
            rotation="0 180 0"
            position=".15 0.15 0"
            side="double"
            scale=".5 .5 .5"
          ></a-text> -->
  
        </a-entity>
      </template>

        <!-- /Templates -->
        <a-asset-item
        id="avatarmodel"
        src="./assets/models/avatar.glb"
      ></a-asset-item>
        <a-asset-item id="gallery" src="./assets/models/galleryforop-v1.glb"></a-asset-item>
        <a-asset-item id="nav-mesh" src="./assets/models/navmesh.glb"></a-asset-item>

      </a-assets>



      <a-entity
      id="rig"
      movement-controls="speed: 0.4;  constrainToNavMesh: true"
      position="13.487 0 8.941 "
      spawn-in-circle="radius:1"
      networked="template:#rig-template;"
    
    >
      <a-entity
        id="player"
        camera="near: 0.099;"
        position="0 3.1 0"
        look-controls
        networked="template:#avatar-template;attachTemplateToLocal:false;"
        visible="true"
      >
      <a-cursor></a-cursor>
      </a-entity>
      <a-entity laser-controls="hand: left"></a-entity>
  <a-entity laser-controls="hand: right"></a-entity>
    </a-entity>



    


    <!-- HTML/////////////////////// -->

    <!-- <a-entity position="9.52 2.46649 16.79274" htmlembed="" scale="3 3 3" style="display: none; position: absolute; top: 0px; left: 0px; overflow: hidden;" rotation="0 160 0">
      <Button onclick="console.log('do something')">Mute Mic</Button>
     </a-entity> -->








      <a-ocean-plane height="100" width="100" position="0 -1 0"></a-ocean-plane>

      <!-- <a-light type="ambient" intensity="0"></a-light> -->
      <a-gltf-model scale="0.2 0.2 0.2" src="#gallery"></a-gltf-model>
      <a-gltf-model scale="0.2 0.2 0.2" src="#nav-mesh" nav-mesh visible="false"></a-gltf-model>
      
      <a-entity light="color: #87601d; intensity: 0.6; castShadow: true" position="65.46418 5.64874 46.8977"></a-entity>
      <a-sky rotation="0 180 0" src="https://cdn.glitch.global/c2ccdc8b-d87a-49af-95e6-e3cd029bbd31/2048-polyhaven-wasteland_clouds_puresky.jpeg?v=1699386634988"></a-sky>
      
     
      



    </a-scene>


<a-image src="./assets/icons/mic.svg"></a-image>


    <div class="actions">
      <button id="mic-btn" type="button" class="button">Mute Mic</button>
  
    </div>

    <script>
      // Mic status
      let micEnabled = true;
      // Mic button element
      const micBtnEle = document.getElementById('mic-btn');

      // Called by Networked-Aframe when connected to server
      function onConnect() {
        console.log('onConnect', new Date());

        // Handle mic button click (Mute and Unmute)
        micBtnEle.addEventListener('click', function () {
          NAF.connection.adapter.enableMicrophone(!micEnabled);
          micEnabled = !micEnabled;
          micBtnEle.textContent = micEnabled ? 'Mute Mic' : 'Unmute Mic';
        });
      }
    </script>
  </body>
</html>
